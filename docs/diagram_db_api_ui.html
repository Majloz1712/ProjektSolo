<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Diagram DB + API + UI</title>
  <style>
    body { margin: 0; background: #ffffff; font-family: Arial, sans-serif; }
    svg { width: 1400px; height: 1000px; }
    .box { fill: #f7f9fc; stroke: #1f2d3d; stroke-width: 2; }
    .label { font-size: 16px; fill: #0f172a; }
    .arrow { stroke: #334155; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
  </style>
</head>
<body>
<svg viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#334155" />
    </marker>
  </defs>

  <!-- Row 1 -->
  <rect class="box" x="40" y="60" width="320" height="90" rx="12" />
  <text class="label" x="200" y="95" text-anchor="middle">Plugin/Agent</text>
  <text class="label" x="200" y="120" text-anchor="middle">(screenshots/HTML)</text>

  <rect class="box" x="540" y="60" width="320" height="90" rx="12" />
  <text class="label" x="700" y="95" text-anchor="middle">API: /plugin-tasks/:id/result</text>
  <text class="label" x="700" y="120" text-anchor="middle">/price</text>

  <rect class="box" x="1040" y="60" width="320" height="90" rx="12" />
  <text class="label" x="1200" y="95" text-anchor="middle">MongoDB</text>
  <text class="label" x="1200" y="120" text-anchor="middle">collection: snapshots</text>

  <!-- Row 2 -->
  <rect class="box" x="540" y="230" width="320" height="90" rx="12" />
  <text class="label" x="700" y="265" text-anchor="middle">Pipeline: handleNewSnapshot</text>

  <rect class="box" x="40" y="400" width="320" height="90" rx="12" />
  <text class="label" x="200" y="435" text-anchor="middle">OCR</text>
  <text class="label" x="200" y="460" text-anchor="middle">ensureSnapshotOcr</text>

  <rect class="box" x="540" y="400" width="320" height="90" rx="12" />
  <text class="label" x="700" y="435" text-anchor="middle">LLM #1</text>
  <text class="label" x="700" y="460" text-anchor="middle">ensureSnapshotAnalysis</text>
  <text class="label" x="700" y="485" text-anchor="middle">collection: analizy</text>

  <rect class="box" x="1040" y="400" width="320" height="90" rx="12" />
  <text class="label" x="1200" y="435" text-anchor="middle">Prev snapshot</text>
  <text class="label" x="1200" y="460" text-anchor="middle">getPreviousSnapshot</text>
  <text class="label" x="1200" y="485" text-anchor="middle">+ prevAnalysis</text>

  <!-- Row 3 -->
  <rect class="box" x="540" y="570" width="320" height="90" rx="12" />
  <text class="label" x="700" y="605" text-anchor="middle">computeMachineDiff</text>
  <text class="label" x="700" y="630" text-anchor="middle">(diffEngine)</text>

  <rect class="box" x="40" y="570" width="320" height="90" rx="12" />
  <text class="label" x="200" y="605" text-anchor="middle">Early exit</text>
  <text class="label" x="200" y="630" text-anchor="middle">no_change</text>

  <rect class="box" x="1040" y="570" width="320" height="90" rx="12" />
  <text class="label" x="1200" y="605" text-anchor="middle">LLM #2 / rules</text>
  <text class="label" x="1200" y="630" text-anchor="middle">evaluateChangeWithLLM</text>
  <text class="label" x="1200" y="655" text-anchor="middle">collection: oceny_zmian</text>

  <!-- Row 4 -->
  <rect class="box" x="540" y="740" width="320" height="90" rx="12" />
  <text class="label" x="700" y="775" text-anchor="middle">Postgres</text>
  <text class="label" x="700" y="800" text-anchor="middle">wykrycia / powiadomienia</text>
  <text class="label" x="700" y="825" text-anchor="middle">+ zadania_skanu</text>

  <rect class="box" x="1040" y="740" width="320" height="90" rx="12" />
  <text class="label" x="1200" y="775" text-anchor="middle">UI / Panel</text>
  <text class="label" x="1200" y="800" text-anchor="middle">API: /historia</text>

  <!-- Arrows -->
  <line class="arrow" x1="360" y1="105" x2="540" y2="105" />
  <line class="arrow" x1="860" y1="105" x2="1040" y2="105" />
  <line class="arrow" x1="700" y1="150" x2="700" y2="230" />
  <line class="arrow" x1="700" y1="320" x2="700" y2="400" />
  <line class="arrow" x1="700" y1="320" x2="200" y2="400" />
  <line class="arrow" x1="700" y1="320" x2="1200" y2="400" />
  <line class="arrow" x1="700" y1="490" x2="700" y2="570" />
  <line class="arrow" x1="1200" y1="490" x2="700" y2="570" />
  <line class="arrow" x1="700" y1="660" x2="200" y2="615" />
  <line class="arrow" x1="700" y1="660" x2="1200" y2="615" />
  <line class="arrow" x1="1200" y1="660" x2="700" y2="740" />
  <line class="arrow" x1="700" y1="830" x2="1200" y2="785" />
</svg>
</body>
</html>
